/*
========================================================================================
    CONFIG
========================================================================================
*/

process {
    publishDir = [
        path: { "${params.outdir}/${task.process.tokenize(':')[-1].tokenize('_')[0].toLowerCase()}" },
        mode: "${params.publish_dir_mode}",
        saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
    ]

    withLabel: sequencing {
		container = "bahnk/sequencing:v1"
	}

    withLabel: demultiplexing {
		publishDir = [
			path: { "${params.outdir}/files" },
			mode: "${params.publish_dir_mode}"
		]
	}

    // withLabel: quality_control {
	// 	publishDir = [
	// 		path: { Paths.get( params.out_dir , "qc" ) },
	// 		mode: publish_mode,
	// 		overwrite: publish_overwrite
	// 	]
	// }

    withName: FASTQC {
        publishDir = [
            path: { "${params.outdir}/qc/fastqc" },
            mode: "${params.publish_dir_mode}",
            enabled: true
        ]
    }

    withName: PLOT_UP_MATCHING {
        ext.script = "plot_up_matching.py"
        ext.args = ""
        ext.ext = ""
        publishDir = [
            path: { "${params.outdir}/plots" },
            mode: "${params.publish_dir_mode}",
            enabled: true
        ]
    }
}

	// withLabel: pucks {
	// 	publishDir = [
	// 		path: { Paths.get( params.out_dir , "files" , "pucks" ) },
	// 		mode: publish_mode,
	// 		overwrite: publish_overwrite
	// 	]
	// }

	// withLabel: tagging {
	// 	publishDir = [
	// 		path: { Paths.get( params.out_dir , "files" ) },
	// 		mode: publish_mode,
	// 		overwrite: publish_overwrite
	// 	]
	// }



	// withLabel: plot {

	// 	executor = "local"
	// 	container = "docker://bahnk/python:v1"

	// 	publishDir = [
	// 		path: { Paths.get( params.out_dir , "qc" , "plots" ) },
	// 		mode: publish_mode,
	// 		overwrite: publish_overwrite
	// 	]
	// }

	// ////////////////////////////////////////////////////////////////////////////



	// withLabel: python {
	// 	container = "docker://bahnk/python:v1"
	// }

	// withLabel: samtools {
	// 	container = "docker://bahnk/samtools:v1"
	// }

	// ///////////////////////////////////////////////////////////////////////////

	// //withName: bcl2fastq {

	// //	module = "bcl2fastq2/2.20.0-foss-2018b"

	// //	executor = "slurm"
	// //	cpus = 12
	// //	memory = "60GB"
	// //	time = "06:00:00"
	// //}

	// withName: star {

	// 	module = "STAR/2.5.2a-foss-2016b"

	// 	executor = "slurm"
	// 	cpus = 24
	// 	memory = "300G"
	// 	time = "10:00:00"
	// 	clusterOptions = "--partition=hmem"
	// }

	// withName: mark_duplicates {

	// 	executor = "slurm"
	// 	cpus = 24
	// 	memory = "400G"
	// 	time = "10:00:00"
	// 	clusterOptions = "--partition=hmem"
	// }

	// withName: bam_tag {

	// 	executor = "slurm"
	// 	cpus = 8
	// 	memory = "80G"
	// }

	// withName: bam_tag_hmem {

	// 	executor = "slurm"
	// 	cpus = 32
	// 	memory = "600G"
	// 	time = "24:00:00"
	// 	clusterOptions = "--partition=hmem"
	// }

	// withName: umis_per_barcode {

	// 	executor = "slurm"
	// 	cpus = 32
	// 	memory = "600G"
	// 	time = "24:00:00"
	// 	clusterOptions = "--partition=hmem"
	// }

	// withName: bam_metrics {

	// 	cpus = 8
	// 	executor = "slurm"
	// 	memory = "80G"
	// }

	// withName: bam_metrics_hmem {

	// 	cpus = 32
	// 	executor = "slurm"
	// 	memory = "400G"
	// 	time = "10:00:00"
	// 	clusterOptions = "--partition=hmem"
	// }